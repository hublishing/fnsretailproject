<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Join Page</title>
    <link rel="stylesheet" href="/public/css/login.css">
</head>
<body>
    
    <div class="wrapper">
        <form id="signup-form">
            <h1>Join</h1>
            <div class="input-box">
                <input type="text" id="email" placeholder="email" required>
                <i class="bx bxs-user"></i>
            </div>
            <div class="input-box">
                <input type="password" id="password" placeholder="password" required>
                <i class="bx bxs-lock-alt"></i>
            </div> 
            
            <div class="errortext" id="errortext">
                <!-- 오류 메시지 출력 -->
            </div>
            <button type="submit" class="btn">Join</button>

            <div class="register-link">
                <p>Already have an account? <a href="/index.html">Login</a></p>
            </div>
        </form>
    </div>

    <!-- AWS SDK for JavaScript -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
    <script>
        // AWS SDK 설정
        AWS.config.region = 'ap-northeast-2'; // 리전 설정
        AWS.config.credentials = new AWS.CognitoIdentityCredentials({
            IdentityPoolId: 'ap-northeast-2:f9436d0a-34cf-4825-a198-188ec11c41b7' // 자격 증명 풀 ID
        });

        const signupForm = document.getElementById('signup-form');
        const errorText = document.getElementById('errortext');

        // HMAC SHA256 알고리즘을 사용한 SECRET_HASH 생성 함수
        function generateSecretHash(username, clientId, clientSecret) {
            return CryptoJS.HmacSHA256(username + clientId, clientSecret).toString(CryptoJS.enc.Base64);
        }

        signupForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // App Client ID 및 App Client Secret 설정
            const clientId = '122g2i26b7erslg90ut69s227l';  // App Client ID
            const clientSecret = '1k58hsg4v7r0poce85l98cong6aksfggs1n4opmsjb56q98t9bvq';  // App Client Secret

            // SECRET_HASH 생성
            const secretHash = generateSecretHash(email, clientId, clientSecret);

            // AWS Cognito를 위한 서비스 프로바이더 생성
            const cognito = new AWS.CognitoIdentityServiceProvider();

            const params = {
                ClientId: clientId,
                SecretHash: secretHash,  // 생성된 Secret Hash 추가
                Username: email,
                Password: password,
                UserAttributes: [
                    {
                        Name: 'email',
                        Value: email
                    }
                ]
            };

            // Cognito 사용자 회원가입 API 호출
            cognito.signUp(params, function(err, data) {
                if (err) {
                    console.log(err, err.stack);
                    errorText.innerText = 'Error: ' + err.message;
                } else {
                    console.log(data);
                    errorText.innerText = '회원가입 성공! 로그인 페이지로 이동합니다.';
                    setTimeout(() => {
                        window.location.href = '/index.html';
                    }, 100);  // 2초 후 로그인 페이지로 리다이렉션
                }
            });
        });
    </script>

    <!-- CryptoJS 라이브러리 추가 (HMAC SHA256 해시 생성에 필요) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>

</body>
</html>
