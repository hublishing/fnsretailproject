<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Join Page</title>
    <link rel="stylesheet" href="/public/css/login.css">
</head>
<body>
    
    <div class="wrapper">
        <form id="signup-form">
            <h1>Join</h1>
            <div class="input-box">
                <input type="text" id="email" placeholder="email" required>
                <i class="bx bxs-user"></i>
            </div>
            <div class="input-box">
                <input type="password" id="password" placeholder="password" required>
                <i class="bx bxs-lock-alt"></i>
            </div> 
            
            <div class="errortext" id="errortext">
                <!-- 오류 메시지 출력 -->
            </div>
            <button type="submit" class="btn">Join</button>

            <div class="register-link">
                <p>Already have an account? <a href="/index.html">Login</a></p>
            </div>
        </form>
    </div> 

    <!-- AWS SDK for JavaScript -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
    <script>
        // AWS SDK 설정
        AWS.config.region = 'ap-northeast-2'; // 리전 설정
        AWS.config.credentials = new AWS.CognitoIdentityCredentials({
            IdentityPoolId: 'ap-northeast-2:f9436d0a-34cf-4825-a198-188ec11c41b7' // Identity Pool ID
        });

        const signupForm = document.getElementById('signup-form');
        const errorText = document.getElementById('errortext');

        signupForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // AWS Cognito를 위한 서비스 프로바이더 생성
            const cognito = new AWS.CognitoIdentityServiceProvider();

            const params = {
                ClientId: 'ap-northeast-2_4BBJiRrR9',  // Cognito 사용자 풀 웹 클라이언트 ID
                Username: email,
                Password: password,
                UserAttributes: [
                    {
                        Name: 'email',
                        Value: email
                    }
                ]
            };

            // Cognito 사용자 회원가입 API 호출
            cognito.signUp(params, function(err, data) {
                if (err) {
                    console.log(err, err.stack);
                    errorText.innerText = 'Error: ' + err.message;
                } else {
                    console.log(data);
                    errorText.innerText = '회원가입 성공! 로그인 페이지로 이동합니다.';
                    setTimeout(() => {
                        window.location.href = '/index.html';
                    }, 2000);  // 2초 후 로그인 페이지로 리다이렉션
                }
            });
        });
    </script>
</body>
</html>
